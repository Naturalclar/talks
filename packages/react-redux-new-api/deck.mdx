import Code from "mdx-code";
import { Avatar, Profile } from "@naturalclar/slides-components";
import { CodeSurferLayout, CodeSurferColumnLayout } from "code-surfer";
export { vsDark as theme } from "code-surfer";

## connect の要らない react-redux

[React.js Meetup #8](https://reactjs-meetup.connpass.com/event/138738/)
@natural_clar

---

## About Me

<Avatar />
<Profile/>

---

## react-redux v7

- [Hooks](https://react-redux.js.org/next/api/hooks)

---

## useSelector

```js
useSelector(selector, comparison);
```

---

## useDispatch

```js
useDispatch();
```

- `dispatch` が返ってくる
- `useCallback` などと組み合わせたら `mapDispatchToProps` のかわりになる

---

<CodeSurferLayout>

```jsx 1:19
import React from "react";
import { connect } from "react-redux";
import { someAction } from "../actions";

const Foo = ({ title, onPressBar }) => {
  return <button onClick={onPressBar}>{title}</button>;
};

const mapStateToProps = (state) => ({
  title: state.title
})

const mapDispatchToProps = (dispatch) => ({
  onPressBar = () => { dispatch(someAction) }
})

export default connect(mapStateToProps,mapDispatchToProps)(Foo);
```

```js subtitle="mapStateToProps を useSelector に変える"
import React from "react";
import { connect, useSelector } from "react-redux";
import { someAction } from "../actions";

const Foo = ({ title, onPressBar }) => {
  const title = useSelector(state => state.title);

  return <button onClick={onPressBar}>{title}</button>;
};

const mapStateToProps = (state) => ({
  title: state.title
})

const mapDispatchToProps = (dispatch) => ({
  onPressBar = () => { dispatch(someAction) }
})

export default connect(mapStateToProps,mapDispatchToProps)(Foo);
```

```js subtitle="mapDispatchToProps を useDispatch に変更"
import React from "react";
import { connect, useSelector, useDispatch } from "react-redux";
import { someAction } from "../actions";

const Foo = ({ title, onPressBar }) => {
  const title = useSelector(state => state.title);
  const dispatch = useDispatch();
  const onPressBar = dispatch(someAction);

  return <button onClick={onPressBar}>{title}</button>;
};

const mapStateToProps = (state) => ({
  title: state.title
})

const mapDispatchToProps = (dispatch) => ({
  onPressBar = () => { dispatch(someAction) }
})

export default connect(mapStateToProps,mapDispatchToProps)(Foo);
```

```js 1:24 subtitle="これで・・・"
import React from "react";
import { connect, useSelector, useDispatch } from "react-redux";
import { someAction } from "../actions";

const Foo = ({ title, onPressBar }) => {
  const title = useSelector(state => state.title);
  const dispatch = useDispatch();
  const onPressBar = dispatch(someAction);

  return <button onClick={onPressBar}>{title}</button>;
};

const mapStateToProps = (state) => ({
  title: state.title
})

const mapDispatchToProps = (dispatch) => ({
  onPressBar = () => { dispatch(someAction) }
})

export default connect(mapStateToProps,mapDispatchToProps)(Foo);
```

```js subtitle="さらば connect !"
import React from "react";
import { useSelector, useDispatch } from "react-redux";
import { someAction } from "../actions";

const Foo = () => {
  const title = useSelector(state => state.title);
  const dispatch = useDispatch();
  const onPressBar = dispatch(someAction);

  return <button onClick={onPressBar}>{title}</button>;
};

export default Foo;
```

```js subtitle="必要な箇所を取ってくるSelectorに変更したり"
import React from "react";
import { useSelector, useDispatch } from "react-redux";
import { someAction } from "../actions";
import { getTitle } from "../selectors";

const Foo = () => {
  const title = useSelector(getTitle);
  const dispatch = useDispatch();
  const onPressBar = dispatch(someAction);

  return <button onClick={onPressBar}>{title}</button>;
};

export default Foo;
```

```js subtitle="必要な箇所を custom hooks にしたり"
import React from "react";
import { useBar } from "../hooks";

const Foo = () => {
  const { title, onPressBar } = useBar();
  return <button onClick={onPressBar}>{title}</button>;
};

export default Foo;
```

</CodeSurferLayout>

---

## ありがとうございました
